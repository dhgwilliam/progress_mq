<%=
require 'yaml'

hosts = servers.keys.collect do |key|
  servers[key]['ssl'] = true unless servers[key]['ssl']
  servers[key]['port'] = '61613' unless servers[key]['port']
  {
    'login'    => servers[key]['user'],
    'passcode' => servers[key]['password'],
    'host'     => servers[key]['host'],
    'port'     => servers[key]['port'],
    'ssl'      => servers[key]['ssl']
  }
end
{
  'targets' => targets,
  'hosts'   => hosts
}.to_yaml
%>

